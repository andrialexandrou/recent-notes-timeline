/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};

// main.ts
__export(exports, {
  default: () => RecentNotesTimelinePlugin
});
var import_obsidian3 = __toModule(require("obsidian"));

// view.ts
var import_obsidian = __toModule(require("obsidian"));
var VIEW_TYPE_TIMELINE = "recent-notes-timeline-view";
var TimelineView = class extends import_obsidian.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.icon = "clock";
    this.plugin = plugin;
    this.refreshInterval = -1;
  }
  getViewType() {
    return VIEW_TYPE_TIMELINE;
  }
  getDisplayText() {
    return "Recent Notes Timeline";
  }
  async onOpen() {
    const container = this.containerEl.children[1];
    container.empty();
    container.addClass("recent-notes-timeline");
    const contentWrapper = container.createDiv({ cls: "timeline-wrapper" });
    const header = contentWrapper.createDiv({ cls: "timeline-header" });
    const titleContainer = header.createDiv({ cls: "timeline-title-container" });
    const title = titleContainer.createEl("h2", {
      cls: "timeline-title",
      text: "Recent Notes Timeline"
    });
    const subtitle = titleContainer.createEl("p", {
      cls: "timeline-subtitle",
      text: "Your latest updates and creations"
    });
    const statsContainer = header.createDiv({ cls: "timeline-stats" });
    const refreshButton = header.createEl("button", {
      cls: "timeline-refresh-button",
      attr: { "aria-label": "Refresh timeline" }
    });
    refreshButton.innerHTML = "\u21BB";
    refreshButton.addEventListener("click", () => this.refreshTimeline());
    this.contentEl = contentWrapper.createDiv({ cls: "timeline-content" });
    await this.refreshTimeline();
    this.updateStats(statsContainer);
    this.refreshInterval = window.setInterval(() => {
      this.refreshTimeline().then(() => {
        this.updateStats(statsContainer);
      });
    }, 5 * 60 * 1e3);
    this.registerEvent(this.app.vault.on("modify", () => {
      this.refreshTimeline().then(() => {
        this.updateStats(statsContainer);
      });
    }));
    this.registerEvent(this.app.vault.on("create", () => {
      this.refreshTimeline().then(() => {
        this.updateStats(statsContainer);
      });
    }));
  }
  updateStats(container) {
    container.empty();
    const files = this.app.vault.getMarkdownFiles();
    const now = Date.now();
    const dayInMs = 24 * 60 * 60 * 1e3;
    const lastDay = files.filter((file) => now - file.stat.mtime < dayInMs).length;
    const lastWeek = files.filter((file) => now - file.stat.mtime < 7 * dayInMs).length;
    const lastMonth = files.filter((file) => now - file.stat.mtime < 30 * dayInMs).length;
    const daySpan = container.createSpan({ cls: "timeline-stat" });
    daySpan.createSpan({ cls: "timeline-stat-value", text: lastDay.toString() });
    daySpan.createSpan({ cls: "timeline-stat-label", text: " today" });
    const weekSpan = container.createSpan({ cls: "timeline-stat" });
    weekSpan.createSpan({ cls: "timeline-stat-value", text: lastWeek.toString() });
    weekSpan.createSpan({ cls: "timeline-stat-label", text: " this week" });
    const monthSpan = container.createSpan({ cls: "timeline-stat" });
    monthSpan.createSpan({ cls: "timeline-stat-value", text: lastMonth.toString() });
    monthSpan.createSpan({ cls: "timeline-stat-label", text: " this month" });
  }
  async onClose() {
    if (this.refreshInterval !== -1) {
      clearInterval(this.refreshInterval);
      this.refreshInterval = -1;
    }
  }
  async refreshTimeline() {
    this.contentEl.empty();
    const notes = this.getNoteInfos();
    if (notes.length === 0) {
      this.contentEl.createEl("p", {
        text: "No recent notes found.",
        cls: "timeline-empty-message"
      });
      return;
    }
    this.buildTimelineUI(notes);
  }
  getNoteInfos() {
    const notes = [];
    const files = this.app.vault.getMarkdownFiles();
    for (const file of files) {
      const createdTime = file.stat.ctime;
      const modifiedTime = file.stat.mtime;
      const timestamp = Math.max(createdTime, modifiedTime);
      const isCreated = createdTime >= modifiedTime;
      notes.push({
        file,
        timestamp,
        isCreated
      });
    }
    return notes.sort((a, b) => b.timestamp - a.timestamp);
  }
  buildTimelineUI(notes) {
    let currentDate = "";
    const currentYear = new Date().getFullYear();
    for (const note of notes) {
      const date = new Date(note.timestamp);
      const month = date.toLocaleString("en-US", { month: "long" });
      const day = date.getDate();
      const year = date.getFullYear();
      let dateString = `${month} ${day}`;
      if (year !== currentYear) {
        dateString += `, ${year}`;
      }
      if (dateString !== currentDate) {
        currentDate = dateString;
        this.contentEl.createEl("div", {
          cls: "timeline-date-separator",
          text: currentDate
        });
      }
      const entry = this.contentEl.createDiv({ cls: "timeline-entry" });
      const infoSection = entry.createDiv({ cls: "timeline-entry-info" });
      const contentSection = infoSection.createDiv({ cls: "timeline-entry-content" });
      const titleEl = contentSection.createEl("a", {
        cls: "timeline-entry-title",
        text: note.file.basename,
        attr: {
          "data-path": note.file.path,
          "aria-label": `Open note: ${note.file.basename}`
        }
      });
      titleEl.addEventListener("click", (event) => {
        event.preventDefault();
        this.app.workspace.openLinkText(note.file.path, "", false);
      });
      const metaInfo = contentSection.createDiv({ cls: "timeline-entry-meta" });
      const actionEl = metaInfo.createEl("span", {
        cls: "timeline-entry-action",
        text: note.isCreated ? "Created" : "Modified"
      });
      const timeEl = metaInfo.createEl("span", {
        cls: "timeline-entry-time",
        text: date.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })
      });
      this.getFilePreview(note.file).then((preview) => {
        if (preview) {
          const previewEl = entry.createDiv({
            cls: "timeline-entry-preview"
          });
          import_obsidian.MarkdownRenderer.renderMarkdown(preview, previewEl, note.file.path, this);
        }
      });
    }
  }
  async getFilePreview(file) {
    try {
      const content = await this.app.vault.read(file);
      const lines = content.split("\n").slice(0, 7);
      let preview = lines.join("\n");
      if (content.split("\n").length > 7) {
        preview += "\n\n*...*";
      }
      return preview;
    } catch (error) {
      return null;
    }
  }
};

// settings.ts
var import_obsidian2 = __toModule(require("obsidian"));
var DEFAULT_SETTINGS = {
  replaceEmptyState: true
};
var TimelineSettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Recent Notes Timeline Settings" });
    new import_obsidian2.Setting(containerEl).setName("Replace empty state").setDesc('Show timeline when no file is open (replaces "No file is open" view)').addToggle((toggle) => toggle.setValue(this.plugin.settings.replaceEmptyState).onChange(async (value) => {
      this.plugin.settings.replaceEmptyState = value;
      await this.plugin.saveSettings();
    }));
  }
};

// main.ts
var RecentNotesTimelinePlugin = class extends import_obsidian3.Plugin {
  async onload() {
    await this.loadSettings();
    this.addSettingTab(new TimelineSettingTab(this.app, this));
    this.registerView(VIEW_TYPE_TIMELINE, (leaf) => new TimelineView(leaf, this));
    this.addRibbonIcon("clock", "Recent Notes Timeline", () => {
      this.activateView();
    });
    this.addCommand({
      id: "show-recent-notes-timeline",
      name: "Show Recent Notes Timeline",
      callback: () => {
        this.activateView();
      }
    });
    this.registerEvent(this.app.workspace.on("active-leaf-change", () => {
      if (this.settings.replaceEmptyState) {
        this.checkForEmptyState();
      }
    }));
    if (this.settings.replaceEmptyState) {
      setTimeout(() => {
        this.checkForEmptyState();
      }, 500);
    }
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  checkForEmptyState() {
    const activeLeaf = this.app.workspace.activeLeaf;
    if (!activeLeaf)
      return;
    const viewState = activeLeaf.getViewState();
    if (viewState.type === "empty") {
      activeLeaf.setViewState({
        type: VIEW_TYPE_TIMELINE,
        active: true
      });
    }
  }
  async onunload() {
    this.app.workspace.detachLeavesOfType(VIEW_TYPE_TIMELINE);
  }
  async activateView() {
    const existing = this.app.workspace.getLeavesOfType(VIEW_TYPE_TIMELINE);
    if (existing.length) {
      this.app.workspace.revealLeaf(existing[0]);
      return;
    }
    const leaf = this.app.workspace.getLeaf("tab");
    await leaf.setViewState({
      type: VIEW_TYPE_TIMELINE,
      active: true
    });
    this.app.workspace.revealLeaf(leaf);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJ2aWV3LnRzIiwgInNldHRpbmdzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBQbHVnaW4sIFdvcmtzcGFjZUxlYWYgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBUaW1lbGluZVZpZXcsIFZJRVdfVFlQRV9USU1FTElORSB9IGZyb20gJy4vdmlldyc7XG5pbXBvcnQgeyBUaW1lbGluZVNldHRpbmdzLCBERUZBVUxUX1NFVFRJTkdTLCBUaW1lbGluZVNldHRpbmdUYWIgfSBmcm9tICcuL3NldHRpbmdzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmVjZW50Tm90ZXNUaW1lbGluZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gIHNldHRpbmdzOiBUaW1lbGluZVNldHRpbmdzO1xuXG4gIGFzeW5jIG9ubG9hZCgpIHtcbiAgICAvLyBMb2FkIHNldHRpbmdzXG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcbiAgICBcbiAgICAvLyBBZGQgc2V0dGluZ3MgdGFiXG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBUaW1lbGluZVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcblxuICAgIC8vIFJlZ2lzdGVyIHRoZSBjdXN0b20gdmlldyB0eXBlXG4gICAgdGhpcy5yZWdpc3RlclZpZXcoXG4gICAgICBWSUVXX1RZUEVfVElNRUxJTkUsXG4gICAgICAobGVhZikgPT4gbmV3IFRpbWVsaW5lVmlldyhsZWFmLCB0aGlzKVxuICAgICk7XG5cbiAgICAvLyBBZGQgYSByaWJib24gaWNvbiB0byBvcGVuIHRoZSB0aW1lbGluZSBpbiBhIG5ldyB0YWJcbiAgICB0aGlzLmFkZFJpYmJvbkljb24oJ2Nsb2NrJywgJ1JlY2VudCBOb3RlcyBUaW1lbGluZScsICgpID0+IHtcbiAgICAgIHRoaXMuYWN0aXZhdGVWaWV3KCk7XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgYSBjb21tYW5kIHRvIHNob3cgdGhlIHRpbWVsaW5lXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiAnc2hvdy1yZWNlbnQtbm90ZXMtdGltZWxpbmUnLFxuICAgICAgbmFtZTogJ1Nob3cgUmVjZW50IE5vdGVzIFRpbWVsaW5lJyxcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuYWN0aXZhdGVWaWV3KCk7XG4gICAgICB9LFxuICAgIH0pO1xuICAgIFxuICAgIC8vIE92ZXJyaWRlIHRoZSBkZWZhdWx0IGVtcHR5IHN0YXRlIHZpZXcgaWYgZW5hYmxlZFxuICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbignYWN0aXZlLWxlYWYtY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5yZXBsYWNlRW1wdHlTdGF0ZSkge1xuICAgICAgICAgIHRoaXMuY2hlY2tGb3JFbXB0eVN0YXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKTtcbiAgICBcbiAgICAvLyBJbml0aWFsIGNoZWNrIGlmIGVuYWJsZWRcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5yZXBsYWNlRW1wdHlTdGF0ZSkge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuY2hlY2tGb3JFbXB0eVN0YXRlKCk7XG4gICAgICB9LCA1MDApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICB9XG5cbiAgY2hlY2tGb3JFbXB0eVN0YXRlKCkge1xuICAgIC8vIEdldCB0aGUgYWN0aXZlIGxlYWZcbiAgICBjb25zdCBhY3RpdmVMZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmFjdGl2ZUxlYWY7XG4gICAgXG4gICAgaWYgKCFhY3RpdmVMZWFmKSByZXR1cm47XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgd2UncmUgc2hvd2luZyB0aGUgZW1wdHkgc3RhdGVcbiAgICBjb25zdCB2aWV3U3RhdGUgPSBhY3RpdmVMZWFmLmdldFZpZXdTdGF0ZSgpO1xuICAgIFxuICAgIC8vIExvb2sgZm9yIHRoZSBlbXB0eSBzdGF0ZSB2aWV3IHR5cGUgb3IgY2hlY2sgaWYgdGhlIHZpZXcgaXMgZW1wdHlcbiAgICBpZiAodmlld1N0YXRlLnR5cGUgPT09ICdlbXB0eScpIHtcbiAgICAgIC8vIFJlcGxhY2Ugd2l0aCBvdXIgdGltZWxpbmUgdmlld1xuICAgICAgYWN0aXZlTGVhZi5zZXRWaWV3U3RhdGUoe1xuICAgICAgICB0eXBlOiBWSUVXX1RZUEVfVElNRUxJTkUsXG4gICAgICAgIGFjdGl2ZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb251bmxvYWQoKSB7XG4gICAgLy8gVW5sb2FkIHRoZSBwbHVnaW4gYW5kIGNsb3NlIGFueSBvcGVuIHZpZXdzXG4gICAgdGhpcy5hcHAud29ya3NwYWNlLmRldGFjaExlYXZlc09mVHlwZShWSUVXX1RZUEVfVElNRUxJTkUpO1xuICB9XG5cbiAgYXN5bmMgYWN0aXZhdGVWaWV3KCkge1xuICAgIC8vIElmIHRoZSB2aWV3IGlzIGFscmVhZHkgb3BlbiBpbiB0aGUgd29ya3NwYWNlLCBzaG93IHRoYXQgaW5zdGFuY2VcbiAgICBjb25zdCBleGlzdGluZyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoVklFV19UWVBFX1RJTUVMSU5FKTtcbiAgICBpZiAoZXhpc3RpbmcubGVuZ3RoKSB7XG4gICAgICB0aGlzLmFwcC53b3Jrc3BhY2UucmV2ZWFsTGVhZihleGlzdGluZ1swXSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGEgbmV3IGxlYWYgaW4gdGhlIG1haW4gZWRpdG9yIGFyZWFcbiAgICBjb25zdCBsZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYWYoJ3RhYicpO1xuICAgIGF3YWl0IGxlYWYuc2V0Vmlld1N0YXRlKHtcbiAgICAgIHR5cGU6IFZJRVdfVFlQRV9USU1FTElORSxcbiAgICAgIGFjdGl2ZTogdHJ1ZSxcbiAgICB9KTtcbiAgICB0aGlzLmFwcC53b3Jrc3BhY2UucmV2ZWFsTGVhZihsZWFmKTtcbiAgfVxufSIsICJpbXBvcnQgeyBJdGVtVmlldywgVEZpbGUsIFdvcmtzcGFjZUxlYWYsIE1hcmtkb3duUmVuZGVyZXIgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgUmVjZW50Tm90ZXNUaW1lbGluZVBsdWdpbiBmcm9tICcuL21haW4nO1xuaW1wb3J0IFJlY2VudE5vdGVzVGltZWxpbmVQbHVnaW4gZnJvbSAnLi9tYWluJztcblxuZXhwb3J0IGNvbnN0IFZJRVdfVFlQRV9USU1FTElORSA9ICdyZWNlbnQtbm90ZXMtdGltZWxpbmUtdmlldyc7XG5cbmludGVyZmFjZSBOb3RlSW5mbyB7XG4gIGZpbGU6IFRGaWxlO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgaXNDcmVhdGVkOiBib29sZWFuOyAvLyB0cnVlIGlmIGNyZWF0aW9uIGRhdGUgaXMgbW9yZSByZWNlbnQgdGhhbiBtb2RpZmljYXRpb24gZGF0ZVxufVxuXG5leHBvcnQgY2xhc3MgVGltZWxpbmVWaWV3IGV4dGVuZHMgSXRlbVZpZXcge1xuICBwcml2YXRlIHBsdWdpbjogUmVjZW50Tm90ZXNUaW1lbGluZVBsdWdpbjtcbiAgcHJpdmF0ZSBjb250ZW50RWw6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHJlZnJlc2hJbnRlcnZhbDogbnVtYmVyO1xuICBcbiAgLy8gVGhpcyBpY29uIHdpbGwgYmUgc2hvd24gaW4gdGhlIHRhYiBoZWFkZXJcbiAgaWNvbiA9ICdjbG9jayc7XG5cbiAgY29uc3RydWN0b3IobGVhZjogV29ya3NwYWNlTGVhZiwgcGx1Z2luOiBSZWNlbnROb3Rlc1RpbWVsaW5lUGx1Z2luKSB7XG4gICAgc3VwZXIobGVhZik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5yZWZyZXNoSW50ZXJ2YWwgPSAtMTtcbiAgfVxuXG4gIGdldFZpZXdUeXBlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFZJRVdfVFlQRV9USU1FTElORTtcbiAgfVxuXG4gIGdldERpc3BsYXlUZXh0KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuICdSZWNlbnQgTm90ZXMgVGltZWxpbmUnO1xuICB9XG5cbiAgYXN5bmMgb25PcGVuKCkge1xuICAgIC8vIFVzZSB0aGUgZW50aXJlIGNvbnRhaW5lciBmb3IgdGhlIGNvbnRlbnRcbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lckVsLmNoaWxkcmVuWzFdO1xuICAgIGNvbnRhaW5lci5lbXB0eSgpO1xuICAgIFxuICAgIC8vIEFkZCB0aGUgdGltZWxpbmUgY2xhc3MgdG8gdGhlIG1haW4gY29udGFpbmVyXG4gICAgY29udGFpbmVyLmFkZENsYXNzKCdyZWNlbnQtbm90ZXMtdGltZWxpbmUnKTtcbiAgICBcbiAgICAvLyBDcmVhdGUgYSBjb250ZW50IHdyYXBwZXIgd2l0aCBwcm9wZXIgd2lkdGggY29uc3RyYWludHNcbiAgICBjb25zdCBjb250ZW50V3JhcHBlciA9IGNvbnRhaW5lci5jcmVhdGVEaXYoeyBjbHM6ICd0aW1lbGluZS13cmFwcGVyJyB9KTtcbiAgICBcbiAgICAvLyBDcmVhdGUgYSBoZWFkZXIgd2l0aCBhIHJlZnJlc2ggYnV0dG9uXG4gICAgY29uc3QgaGVhZGVyID0gY29udGVudFdyYXBwZXIuY3JlYXRlRGl2KHsgY2xzOiAndGltZWxpbmUtaGVhZGVyJyB9KTtcbiAgICBcbiAgICAvLyBBZGQgYSB0aXRsZVxuICAgIGNvbnN0IHRpdGxlQ29udGFpbmVyID0gaGVhZGVyLmNyZWF0ZURpdih7IGNsczogJ3RpbWVsaW5lLXRpdGxlLWNvbnRhaW5lcicgfSk7XG4gICAgY29uc3QgdGl0bGUgPSB0aXRsZUNvbnRhaW5lci5jcmVhdGVFbCgnaDInLCB7IFxuICAgICAgY2xzOiAndGltZWxpbmUtdGl0bGUnLFxuICAgICAgdGV4dDogJ1JlY2VudCBOb3RlcyBUaW1lbGluZScgXG4gICAgfSk7XG4gICAgY29uc3Qgc3VidGl0bGUgPSB0aXRsZUNvbnRhaW5lci5jcmVhdGVFbCgncCcsIHsgXG4gICAgICBjbHM6ICd0aW1lbGluZS1zdWJ0aXRsZScsXG4gICAgICB0ZXh0OiAnWW91ciBsYXRlc3QgdXBkYXRlcyBhbmQgY3JlYXRpb25zJyBcbiAgICB9KTtcbiAgICBcbiAgICAvLyBBZGQgc3RhdHMgY29udGFpbmVyXG4gICAgY29uc3Qgc3RhdHNDb250YWluZXIgPSBoZWFkZXIuY3JlYXRlRGl2KHsgY2xzOiAndGltZWxpbmUtc3RhdHMnIH0pO1xuICAgIFxuICAgIC8vIEFkZCByZWZyZXNoIGJ1dHRvblxuICAgIGNvbnN0IHJlZnJlc2hCdXR0b24gPSBoZWFkZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHtcbiAgICAgIGNsczogJ3RpbWVsaW5lLXJlZnJlc2gtYnV0dG9uJyxcbiAgICAgIGF0dHI6IHsgJ2FyaWEtbGFiZWwnOiAnUmVmcmVzaCB0aW1lbGluZScgfVxuICAgIH0pO1xuICAgIHJlZnJlc2hCdXR0b24uaW5uZXJIVE1MID0gJ1x1MjFCQic7XG4gICAgcmVmcmVzaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMucmVmcmVzaFRpbWVsaW5lKCkpO1xuXG4gICAgLy8gQ3JlYXRlIHRoZSB0aW1lbGluZSBjb250ZW50IGNvbnRhaW5lclxuICAgIHRoaXMuY29udGVudEVsID0gY29udGVudFdyYXBwZXIuY3JlYXRlRGl2KHsgY2xzOiAndGltZWxpbmUtY29udGVudCcgfSk7XG4gICAgXG4gICAgLy8gTG9hZCB0aGUgaW5pdGlhbCB0aW1lbGluZSBkYXRhXG4gICAgYXdhaXQgdGhpcy5yZWZyZXNoVGltZWxpbmUoKTtcbiAgICBcbiAgICAvLyBVcGRhdGUgc3RhdHMgYWZ0ZXIgbG9hZGluZyBkYXRhXG4gICAgdGhpcy51cGRhdGVTdGF0cyhzdGF0c0NvbnRhaW5lcik7XG4gICAgXG4gICAgLy8gU2V0IHVwIGF1dG8tcmVmcmVzaCBldmVyeSA1IG1pbnV0ZXNcbiAgICB0aGlzLnJlZnJlc2hJbnRlcnZhbCA9IHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICB0aGlzLnJlZnJlc2hUaW1lbGluZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRzKHN0YXRzQ29udGFpbmVyKTtcbiAgICAgIH0pO1xuICAgIH0sIDUgKiA2MCAqIDEwMDApO1xuICAgIFxuICAgIC8vIFJlZ2lzdGVyIGFuIGV2ZW50IGhhbmRsZXIgdG8gcmVmcmVzaCB3aGVuIGZpbGVzIGNoYW5nZVxuICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9uKCdtb2RpZnknLCAoKSA9PiB7XG4gICAgICAgIHRoaXMucmVmcmVzaFRpbWVsaW5lKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgdGhpcy51cGRhdGVTdGF0cyhzdGF0c0NvbnRhaW5lcik7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICApO1xuICAgIFxuICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLnZhdWx0Lm9uKCdjcmVhdGUnLCAoKSA9PiB7XG4gICAgICAgIHRoaXMucmVmcmVzaFRpbWVsaW5lKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgdGhpcy51cGRhdGVTdGF0cyhzdGF0c0NvbnRhaW5lcik7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICApO1xuICB9XG4gIFxuICBwcml2YXRlIHVwZGF0ZVN0YXRzKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb250YWluZXIuZW1wdHkoKTtcbiAgICBcbiAgICBjb25zdCBmaWxlcyA9IHRoaXMuYXBwLnZhdWx0LmdldE1hcmtkb3duRmlsZXMoKTtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGRheUluTXMgPSAyNCAqIDYwICogNjAgKiAxMDAwO1xuICAgIFxuICAgIC8vIENvdW50IGZpbGVzIG1vZGlmaWVkIGluIHRoZSBsYXN0IGRheSwgd2VlaywgYW5kIG1vbnRoXG4gICAgY29uc3QgbGFzdERheSA9IGZpbGVzLmZpbHRlcihmaWxlID0+IChub3cgLSBmaWxlLnN0YXQubXRpbWUpIDwgZGF5SW5NcykubGVuZ3RoO1xuICAgIGNvbnN0IGxhc3RXZWVrID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4gKG5vdyAtIGZpbGUuc3RhdC5tdGltZSkgPCA3ICogZGF5SW5NcykubGVuZ3RoO1xuICAgIGNvbnN0IGxhc3RNb250aCA9IGZpbGVzLmZpbHRlcihmaWxlID0+IChub3cgLSBmaWxlLnN0YXQubXRpbWUpIDwgMzAgKiBkYXlJbk1zKS5sZW5ndGg7XG4gICAgXG4gICAgY29uc3QgZGF5U3BhbiA9IGNvbnRhaW5lci5jcmVhdGVTcGFuKHsgY2xzOiAndGltZWxpbmUtc3RhdCcgfSk7XG4gICAgZGF5U3Bhbi5jcmVhdGVTcGFuKHsgY2xzOiAndGltZWxpbmUtc3RhdC12YWx1ZScsIHRleHQ6IGxhc3REYXkudG9TdHJpbmcoKSB9KTtcbiAgICBkYXlTcGFuLmNyZWF0ZVNwYW4oeyBjbHM6ICd0aW1lbGluZS1zdGF0LWxhYmVsJywgdGV4dDogJyB0b2RheScgfSk7XG4gICAgXG4gICAgY29uc3Qgd2Vla1NwYW4gPSBjb250YWluZXIuY3JlYXRlU3Bhbih7IGNsczogJ3RpbWVsaW5lLXN0YXQnIH0pO1xuICAgIHdlZWtTcGFuLmNyZWF0ZVNwYW4oeyBjbHM6ICd0aW1lbGluZS1zdGF0LXZhbHVlJywgdGV4dDogbGFzdFdlZWsudG9TdHJpbmcoKSB9KTtcbiAgICB3ZWVrU3Bhbi5jcmVhdGVTcGFuKHsgY2xzOiAndGltZWxpbmUtc3RhdC1sYWJlbCcsIHRleHQ6ICcgdGhpcyB3ZWVrJyB9KTtcbiAgICBcbiAgICBjb25zdCBtb250aFNwYW4gPSBjb250YWluZXIuY3JlYXRlU3Bhbih7IGNsczogJ3RpbWVsaW5lLXN0YXQnIH0pO1xuICAgIG1vbnRoU3Bhbi5jcmVhdGVTcGFuKHsgY2xzOiAndGltZWxpbmUtc3RhdC12YWx1ZScsIHRleHQ6IGxhc3RNb250aC50b1N0cmluZygpIH0pO1xuICAgIG1vbnRoU3Bhbi5jcmVhdGVTcGFuKHsgY2xzOiAndGltZWxpbmUtc3RhdC1sYWJlbCcsIHRleHQ6ICcgdGhpcyBtb250aCcgfSk7XG4gIH1cblxuICBhc3luYyBvbkNsb3NlKCkge1xuICAgIC8vIENsZWFyIHRoZSBhdXRvLXJlZnJlc2ggaW50ZXJ2YWwgd2hlbiB0aGUgdmlldyBpcyBjbG9zZWRcbiAgICBpZiAodGhpcy5yZWZyZXNoSW50ZXJ2YWwgIT09IC0xKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMucmVmcmVzaEludGVydmFsKTtcbiAgICAgIHRoaXMucmVmcmVzaEludGVydmFsID0gLTE7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVmcmVzaFRpbWVsaW5lKCkge1xuICAgIC8vIENsZWFyIHRoZSBjdXJyZW50IGNvbnRlbnRcbiAgICB0aGlzLmNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIFxuICAgIC8vIEdldCBhbGwgbm90ZXMgZnJvbSB0aGUgdmF1bHRcbiAgICBjb25zdCBub3RlcyA9IHRoaXMuZ2V0Tm90ZUluZm9zKCk7XG4gICAgXG4gICAgaWYgKG5vdGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5jb250ZW50RWwuY3JlYXRlRWwoJ3AnLCB7IFxuICAgICAgICB0ZXh0OiAnTm8gcmVjZW50IG5vdGVzIGZvdW5kLicsXG4gICAgICAgIGNsczogJ3RpbWVsaW5lLWVtcHR5LW1lc3NhZ2UnXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgLy8gQnVpbGQgdGhlIHRpbWVsaW5lIFVJXG4gICAgdGhpcy5idWlsZFRpbWVsaW5lVUkobm90ZXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXROb3RlSW5mb3MoKTogTm90ZUluZm9bXSB7XG4gICAgY29uc3Qgbm90ZXM6IE5vdGVJbmZvW10gPSBbXTtcbiAgICBcbiAgICAvLyBHZXQgYWxsIG1hcmtkb3duIGZpbGVzIGZyb20gdGhlIHZhdWx0XG4gICAgY29uc3QgZmlsZXMgPSB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCk7XG4gICAgXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICBjb25zdCBjcmVhdGVkVGltZSA9IGZpbGUuc3RhdC5jdGltZTtcbiAgICAgIGNvbnN0IG1vZGlmaWVkVGltZSA9IGZpbGUuc3RhdC5tdGltZTtcbiAgICAgIFxuICAgICAgLy8gVXNlIHRoZSBtb3N0IHJlY2VudCB0aW1lc3RhbXAgKGNyZWF0ZWQgb3IgbW9kaWZpZWQpXG4gICAgICBjb25zdCB0aW1lc3RhbXAgPSBNYXRoLm1heChjcmVhdGVkVGltZSwgbW9kaWZpZWRUaW1lKTtcbiAgICAgIGNvbnN0IGlzQ3JlYXRlZCA9IGNyZWF0ZWRUaW1lID49IG1vZGlmaWVkVGltZTtcbiAgICAgIFxuICAgICAgbm90ZXMucHVzaCh7XG4gICAgICAgIGZpbGUsXG4gICAgICAgIHRpbWVzdGFtcCxcbiAgICAgICAgaXNDcmVhdGVkXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gU29ydCBieSB0aW1lc3RhbXAgaW4gZGVzY2VuZGluZyBvcmRlciAobmV3ZXN0IGZpcnN0KVxuICAgIHJldHVybiBub3Rlcy5zb3J0KChhLCBiKSA9PiBiLnRpbWVzdGFtcCAtIGEudGltZXN0YW1wKTtcbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRUaW1lbGluZVVJKG5vdGVzOiBOb3RlSW5mb1tdKSB7XG4gICAgbGV0IGN1cnJlbnREYXRlID0gJyc7XG4gICAgY29uc3QgY3VycmVudFllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7XG4gICAgXG4gICAgZm9yIChjb25zdCBub3RlIG9mIG5vdGVzKSB7XG4gICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUobm90ZS50aW1lc3RhbXApO1xuICAgICAgXG4gICAgICAvLyBGb3JtYXQgdGhlIGRhdGUgYXMgXCJNb250aCBEYXlcIiBvciBcIk1vbnRoIERheSwgWWVhclwiIGlmIG5vdCBjdXJyZW50IHllYXJcbiAgICAgIGNvbnN0IG1vbnRoID0gZGF0ZS50b0xvY2FsZVN0cmluZygnZW4tVVMnLCB7IG1vbnRoOiAnbG9uZycgfSk7XG4gICAgICBjb25zdCBkYXkgPSBkYXRlLmdldERhdGUoKTtcbiAgICAgIGNvbnN0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICBcbiAgICAgIGxldCBkYXRlU3RyaW5nID0gYCR7bW9udGh9ICR7ZGF5fWA7XG4gICAgICBpZiAoeWVhciAhPT0gY3VycmVudFllYXIpIHtcbiAgICAgICAgZGF0ZVN0cmluZyArPSBgLCAke3llYXJ9YDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQWRkIGRhdGUgc2VwYXJhdG9yIGlmIHdlJ3ZlIG1vdmVkIHRvIGEgbmV3IGRhdGVcbiAgICAgIGlmIChkYXRlU3RyaW5nICE9PSBjdXJyZW50RGF0ZSkge1xuICAgICAgICBjdXJyZW50RGF0ZSA9IGRhdGVTdHJpbmc7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmNvbnRlbnRFbC5jcmVhdGVFbCgnZGl2Jywge1xuICAgICAgICAgIGNsczogJ3RpbWVsaW5lLWRhdGUtc2VwYXJhdG9yJyxcbiAgICAgICAgICB0ZXh0OiBjdXJyZW50RGF0ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHRoZSB0aW1lbGluZSBlbnRyeVxuICAgICAgY29uc3QgZW50cnkgPSB0aGlzLmNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6ICd0aW1lbGluZS1lbnRyeScgfSk7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSB0aGUgbm90ZSBpbmZvIHNlY3Rpb25cbiAgICAgIGNvbnN0IGluZm9TZWN0aW9uID0gZW50cnkuY3JlYXRlRGl2KHsgY2xzOiAndGltZWxpbmUtZW50cnktaW5mbycgfSk7XG4gICAgICBcbiAgICAgIC8vIEFkZCBtYWluIGNvbnRlbnQgY29udGFpbmVyXG4gICAgICBjb25zdCBjb250ZW50U2VjdGlvbiA9IGluZm9TZWN0aW9uLmNyZWF0ZURpdih7IGNsczogJ3RpbWVsaW5lLWVudHJ5LWNvbnRlbnQnIH0pO1xuICAgICAgXG4gICAgICAvLyBBZGQgZmlsZSBuYW1lIGFzIGEgbGlua1xuICAgICAgY29uc3QgdGl0bGVFbCA9IGNvbnRlbnRTZWN0aW9uLmNyZWF0ZUVsKCdhJywge1xuICAgICAgICBjbHM6ICd0aW1lbGluZS1lbnRyeS10aXRsZScsXG4gICAgICAgIHRleHQ6IG5vdGUuZmlsZS5iYXNlbmFtZSxcbiAgICAgICAgYXR0cjoge1xuICAgICAgICAgICdkYXRhLXBhdGgnOiBub3RlLmZpbGUucGF0aCxcbiAgICAgICAgICAnYXJpYS1sYWJlbCc6IGBPcGVuIG5vdGU6ICR7bm90ZS5maWxlLmJhc2VuYW1lfWBcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIE9wZW4gdGhlIG5vdGUgd2hlbiBjbGlja2VkXG4gICAgICB0aXRsZUVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQobm90ZS5maWxlLnBhdGgsICcnLCBmYWxzZSk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gQWRkIGFjdGlvbiBpbmRpY2F0b3IgYW5kIHRpbWVzdGFtcFxuICAgICAgY29uc3QgbWV0YUluZm8gPSBjb250ZW50U2VjdGlvbi5jcmVhdGVEaXYoeyBjbHM6ICd0aW1lbGluZS1lbnRyeS1tZXRhJyB9KTtcbiAgICAgIFxuICAgICAgLy8gQWN0aW9uIHRleHRcbiAgICAgIGNvbnN0IGFjdGlvbkVsID0gbWV0YUluZm8uY3JlYXRlRWwoJ3NwYW4nLCB7XG4gICAgICAgIGNsczogJ3RpbWVsaW5lLWVudHJ5LWFjdGlvbicsXG4gICAgICAgIHRleHQ6IG5vdGUuaXNDcmVhdGVkID8gJ0NyZWF0ZWQnIDogJ01vZGlmaWVkJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIEFkZCBhIHRpbWVzdGFtcFxuICAgICAgY29uc3QgdGltZUVsID0gbWV0YUluZm8uY3JlYXRlRWwoJ3NwYW4nLCB7XG4gICAgICAgIGNsczogJ3RpbWVsaW5lLWVudHJ5LXRpbWUnLFxuICAgICAgICB0ZXh0OiBkYXRlLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gVHJ5IHRvIGdldCBhIHByZXZpZXcgb2YgdGhlIGNvbnRlbnRcbiAgICAgIHRoaXMuZ2V0RmlsZVByZXZpZXcobm90ZS5maWxlKS50aGVuKHByZXZpZXcgPT4ge1xuICAgICAgICBpZiAocHJldmlldykge1xuICAgICAgICAgIGNvbnN0IHByZXZpZXdFbCA9IGVudHJ5LmNyZWF0ZURpdih7XG4gICAgICAgICAgICBjbHM6ICd0aW1lbGluZS1lbnRyeS1wcmV2aWV3J1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFVzZSBPYnNpZGlhbidzIE1hcmtkb3duIHJlbmRlcmVyXG4gICAgICAgICAgTWFya2Rvd25SZW5kZXJlci5yZW5kZXJNYXJrZG93bihcbiAgICAgICAgICAgIHByZXZpZXcsXG4gICAgICAgICAgICBwcmV2aWV3RWwsXG4gICAgICAgICAgICBub3RlLmZpbGUucGF0aCxcbiAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gV2UncmUgcmVtb3ZpbmcgdGhlIGZpbGUgcGF0aCBkaXNwbGF5IGFzIHJlcXVlc3RlZFxuICAgICAgXG4gICAgICAvLyBPcGVuIGJ1dHRvbiByZW1vdmVkIGFzIHJlcXVlc3RlZFxuICAgIH1cbiAgfVxuICBcbiAgLy8gSGVscGVyIG1ldGhvZCB0byBnZXQgYSBwcmV2aWV3IG9mIHRoZSBmaWxlIGNvbnRlbnQgZm9yIG1hcmtkb3duIHJlbmRlcmluZ1xuICBwcml2YXRlIGFzeW5jIGdldEZpbGVQcmV2aWV3KGZpbGU6IFRGaWxlKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJlYWQgdGhlIGVudGlyZSBmaWxlIGNvbnRlbnRcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgXG4gICAgICAvLyBHZXQgdGhlIGxpbmVzIG9mIGNvbnRlbnQgKHVwIHRvIDcgbGluZXMpXG4gICAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpLnNsaWNlKDAsIDcpO1xuICAgICAgXG4gICAgICAvLyBKb2luIHRoZSBsaW5lcyBiYWNrIHRvZ2V0aGVyXG4gICAgICBsZXQgcHJldmlldyA9IGxpbmVzLmpvaW4oJ1xcbicpO1xuICAgICAgXG4gICAgICAvLyBJZiB0aGVyZSBhcmUgbW9yZSBsaW5lcywgYWRkIGFuIGluZGljYXRvclxuICAgICAgaWYgKGNvbnRlbnQuc3BsaXQoJ1xcbicpLmxlbmd0aCA+IDcpIHtcbiAgICAgICAgcHJldmlldyArPSAnXFxuXFxuKi4uLionO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gcHJldmlldztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG59IiwgImltcG9ydCB7IEFwcCwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCBSZWNlbnROb3Rlc1RpbWVsaW5lUGx1Z2luIGZyb20gJy4vbWFpbic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGltZWxpbmVTZXR0aW5ncyB7XG4gICAgcmVwbGFjZUVtcHR5U3RhdGU6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBUaW1lbGluZVNldHRpbmdzID0ge1xuICAgIHJlcGxhY2VFbXB0eVN0YXRlOiB0cnVlXG59O1xuXG5leHBvcnQgY2xhc3MgVGltZWxpbmVTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gICAgcGx1Z2luOiBSZWNlbnROb3Rlc1RpbWVsaW5lUGx1Z2luO1xuXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogUmVjZW50Tm90ZXNUaW1lbGluZVBsdWdpbikge1xuICAgICAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIH1cblxuICAgIGRpc3BsYXkoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcblxuICAgICAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdSZWNlbnQgTm90ZXMgVGltZWxpbmUgU2V0dGluZ3MnIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoJ1JlcGxhY2UgZW1wdHkgc3RhdGUnKVxuICAgICAgICAgICAgLnNldERlc2MoJ1Nob3cgdGltZWxpbmUgd2hlbiBubyBmaWxlIGlzIG9wZW4gKHJlcGxhY2VzIFwiTm8gZmlsZSBpcyBvcGVuXCIgdmlldyknKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnJlcGxhY2VFbXB0eVN0YXRlKVxuICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucmVwbGFjZUVtcHR5U3RhdGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgIH1cbn0iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQSx1QkFBc0M7OztBQ0F0QyxzQkFBaUU7QUFJMUQsSUFBTSxxQkFBcUI7QUFRM0IsaUNBQTJCLHlCQUFTO0FBQUEsRUFRekMsWUFBWSxNQUFxQixRQUFtQztBQUNsRSxVQUFNO0FBSFIsZ0JBQU87QUFJTCxTQUFLLFNBQVM7QUFDZCxTQUFLLGtCQUFrQjtBQUFBO0FBQUEsRUFHekIsY0FBc0I7QUFDcEIsV0FBTztBQUFBO0FBQUEsRUFHVCxpQkFBeUI7QUFDdkIsV0FBTztBQUFBO0FBQUEsUUFHSCxTQUFTO0FBRWIsVUFBTSxZQUFZLEtBQUssWUFBWSxTQUFTO0FBQzVDLGNBQVU7QUFHVixjQUFVLFNBQVM7QUFHbkIsVUFBTSxpQkFBaUIsVUFBVSxVQUFVLEVBQUUsS0FBSztBQUdsRCxVQUFNLFNBQVMsZUFBZSxVQUFVLEVBQUUsS0FBSztBQUcvQyxVQUFNLGlCQUFpQixPQUFPLFVBQVUsRUFBRSxLQUFLO0FBQy9DLFVBQU0sUUFBUSxlQUFlLFNBQVMsTUFBTTtBQUFBLE1BQzFDLEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUVSLFVBQU0sV0FBVyxlQUFlLFNBQVMsS0FBSztBQUFBLE1BQzVDLEtBQUs7QUFBQSxNQUNMLE1BQU07QUFBQTtBQUlSLFVBQU0saUJBQWlCLE9BQU8sVUFBVSxFQUFFLEtBQUs7QUFHL0MsVUFBTSxnQkFBZ0IsT0FBTyxTQUFTLFVBQVU7QUFBQSxNQUM5QyxLQUFLO0FBQUEsTUFDTCxNQUFNLEVBQUUsY0FBYztBQUFBO0FBRXhCLGtCQUFjLFlBQVk7QUFDMUIsa0JBQWMsaUJBQWlCLFNBQVMsTUFBTSxLQUFLO0FBR25ELFNBQUssWUFBWSxlQUFlLFVBQVUsRUFBRSxLQUFLO0FBR2pELFVBQU0sS0FBSztBQUdYLFNBQUssWUFBWTtB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
